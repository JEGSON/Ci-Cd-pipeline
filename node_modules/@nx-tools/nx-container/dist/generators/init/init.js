"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initGenerator = initGenerator;
const devkit_1 = require("@nx/devkit");
async function initGenerator(tree, options) {
    const tasks = [];
    const nxJson = (0, devkit_1.readNxJson)(tree);
    // Add container plugin to Nx configuration if not already present
    if (nxJson && !hasContainerPlugin(nxJson)) {
        nxJson.plugins ??= [];
        const pluginConfig = {
            plugin: '@nx-tools/nx-container',
            options: { defaultEngine: options.defaultEngine, defaultRegistry: options.defaultRegistry },
        };
        nxJson.plugins.push(pluginConfig);
        (0, devkit_1.updateNxJson)(tree, nxJson);
    }
    return (0, devkit_1.runTasksInSerial)(...tasks);
}
function hasContainerPlugin(nxJson) {
    return (nxJson.plugins?.some((plugin) => typeof plugin === 'string' ? plugin === '@nx-tools/nx-container' : plugin.plugin === '@nx-tools/nx-container') ?? false);
}
exports.default = initGenerator;
