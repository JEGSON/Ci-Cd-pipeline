"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Github = void 0;
exports.repo = repo;
const tslib_1 = require("tslib");
const github = tslib_1.__importStar(require("@actions/github"));
const context_1 = require("@actions/github/lib/context");
const core_1 = require("@nx-tools/core");
class Github {
    static async context() {
        const ctx = new context_1.Context();
        const { actor, eventName, job, ref, runId, runNumber, sha, serverUrl, payload } = ctx;
        let repoUrl = '';
        try {
            repoUrl = `${serverUrl}/${ctx.repo.owner}/${ctx.repo.repo}`;
        }
        catch (err) {
            core_1.logger.warn(err);
        }
        return {
            name: 'GITHUB',
            actor,
            eventName,
            job,
            payload: payload,
            ref,
            runId,
            runNumber,
            repoUrl,
            sha,
        };
    }
}
exports.Github = Github;
async function repo(token) {
    if (!token) {
        throw new Error(`Missing github token`);
    }
    const response = await github.getOctokit(token).rest.repos.get({
        ...github.context.repo,
    });
    const { default_branch, description, html_url, license, name } = response.data;
    return {
        default_branch,
        description,
        html_url,
        license,
        name,
    };
}
